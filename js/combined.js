(function(){var a=(typeof window!=="undefined")?window.Gun:require("../gun");a.on("opt",function(d){this.to.next(d);var i=d.opt;if(d.once){return}if(!a.Mesh){return}if(false===i.RTCPeerConnection){return}var c;if(typeof window!=="undefined"){c=window}if(typeof global!=="undefined"){c=global}c=c||{};var f=i.RTCPeerConnection||c.RTCPeerConnection||c.webkitRTCPeerConnection||c.mozRTCPeerConnection;var h=i.RTCSessionDescription||c.RTCSessionDescription||c.webkitRTCSessionDescription||c.mozRTCSessionDescription;var e=i.RTCIceCandidate||c.RTCIceCandidate||c.webkitRTCIceCandidate||c.mozRTCIceCandidate;if(!f||!h||!e){return}i.RTCPeerConnection=f;i.RTCSessionDescription=h;i.RTCIceCandidate=e;i.rtc=i.rtc||{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.sipgate.net:3478"}]};i.rtc.dataChannel=i.rtc.dataChannel||{ordered:false,maxRetransmits:2};i.rtc.sdp=i.rtc.sdp||{mandatory:{OfferToReceiveAudio:false,OfferToReceiveVideo:false}};i.announce=function(k){d.on("out",{rtc:{id:i.pid,to:k}})};var j=i.mesh=i.mesh||a.Mesh(d);d.on("create",function(k){this.to.next(k);setTimeout(i.announce,1)});d.on("in",function(k){if(k.rtc){g(k)}this.to.next(k)});function g(m){var o=m.rtc,k,n;if(!o||!o.id){return}delete i.announce[o.id];if(n=o.answer){if(!(k=i.peers[o.id]||g[o.id])||k.remoteSet){return}return k.setRemoteDescription(k.remoteSet=new i.RTCSessionDescription(n))}if(n=o.candidate){k=i.peers[o.id]||g[o.id]||g({rtc:{id:o.id}});return k.addIceCandidate(new i.RTCIceCandidate(n))}if(g[o.id]){return}(k=new i.RTCPeerConnection(i.rtc)).id=o.id;var l=k.wire=k.createDataChannel("dc",i.rtc.dataChannel);g[o.id]=k;l.onclose=function(){delete g[o.id];j.bye(k)};l.onerror=function(p){};l.onopen=function(p){j.hi(k)};l.onmessage=function(p){if(!p){return}j.hear(p.data||p,k)};k.onicecandidate=function(p){if(!p.candidate){return}d.on("out",{"@":m["#"],rtc:{candidate:p.candidate,id:i.pid}})};k.ondatachannel=function(q){var p=q.channel;p.onmessage=l.onmessage;p.onopen=l.onopen;p.onclose=l.onclose};if(n=o.offer){k.setRemoteDescription(new i.RTCSessionDescription(n));k.createAnswer(function(p){k.setLocalDescription(p);d.on("out",{"@":m["#"],rtc:{answer:p,id:i.pid}})},function(){},i.rtc.sdp);return}k.createOffer(function(p){k.setLocalDescription(p);d.on("out",{"@":m["#"],rtc:{offer:p,id:i.pid}})},function(){},i.rtc.sdp);return k}});var b=function(){}}());
!function(){function _(e,t){return t?require(e):e.slice?_[o(e)]:function(t,n){e(t={exports:{}}),_[o(n)]=t.exports};function o(t){return t.split("/").slice(-1).toString().replace(".js","")}}if("undefined"!=typeof module)var y=module;_(function(t){var n,l,p={};function e(t,n){v(this,n)&&void 0!==this[n]||(this[n]=t)}function o(t,n){var e=this.n;if(!e||!(n===e||g(e)&&v(e,n)))return void 0!==n||void 0}function h(t,n){2!==arguments.length?(h.r=h.r||[]).push(t):(h.r=h.r||{})[t]=n}p.fn={is:function(t){return!!t&&"function"==typeof t}},p.bi={is:function(t){return t instanceof Boolean||"boolean"==typeof t}},p.num={is:function(t){return!d(t)&&(0<=t-parseFloat(t)+1||1/0===t||-1/0===t)}},p.text={is:function(t){return"string"==typeof t}},p.text.ify=function(t){return p.text.is(t)?t:"undefined"!=typeof JSON?JSON.stringify(t):t&&t.toString?t.toString():t},p.text.random=function(t,n){var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<t;)e+=n.charAt(Math.floor(Math.random()*n.length)),t--;return e},p.text.match=function(t,n){var e,o;return"string"==typeof t&&("string"==typeof n&&(n={"=":n}),t===(e=(n=n||{})["="]||n["*"]||n[">"]||n["<"])||o===n["="]&&(e=n["*"]||n[">"]||n["<"],t.slice(0,(e||"").length)===e||o===n["*"]&&(o!==n[">"]&&o!==n["<"]?t>=n[">"]&&t<=n["<"]:o!==n[">"]&&t>=n[">"]||o!==n["<"]&&t<=n["<"])))},p.list={is:function(t){return t instanceof Array}},p.list.slit=Array.prototype.slice,p.list.sort=function(e){return function(t,n){return t&&n?(t=t[e])<(n=n[e])?-1:n<t?1:0:0}},p.list.map=function(t,n,e){return r(t,n,e)},p.list.index=1,p.obj={is:function(t){return!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},p.obj.put=function(t,n,e){return(t||{})[n]=e,t},p.obj.has=function(t,n){return t&&Object.prototype.hasOwnProperty.call(t,n)},p.obj.del=function(t,n){if(t)return t[n]=null,delete t[n],t},p.obj.as=function(t,n,e,o){return t[n]=t[n]||(o===e?{}:e)},p.obj.ify=function(n){if(g(n))return n;try{n=JSON.parse(n)}catch(t){n={}}return n},p.obj.to=function(t,n){return r(t,e,n=n||{}),n},p.obj.copy=function(t){return t?JSON.parse(JSON.stringify(t)):t},p.obj.empty=function(t,n){return!t||!r(t,o,{n:n})},l=Object.keys,Object.keys=Object.keys||function(t){return n(t,function(t,n,e){e(n)})},p.obj.map=n=function(t,n,e){var o,i,r,a,u,s=0,f="function"==typeof n;if(h.r=o,l&&g(t)&&(a=l(t),u=!0),e=e||{},d(t)||a)for(i=(a||t).length;s<i;s++){var c=s+p.list.index;if(f){if((r=u?n.call(e,t[a[s]],a[s],h):n.call(e,t[s],c,h))!==o)return r}else if(n===t[u?a[s]:s])return a?a[s]:c}else for(s in t)if(f){if(v(t,s)&&(r=e?n.call(e,t[s],s,h):n(t[s],s,h))!==o)return r}else if(n===t[s])return s;return f?h.r:p.list.index?0:-1},p.time={},p.time.is=function(t){return t?t instanceof Date:+(new Date).getTime()};p.fn.is;var d=p.list.is,i=p.obj,g=i.is,v=i.has,r=i.map;t.exports=p})(_,"./type"),_(function(t){t.exports=function t(n,e,o){if(!n)return{to:t};n=(this.tag||(this.tag={}))[n]||(this.tag[n]={tag:n,to:t._={next:function(t){var n;(n=this.to)&&n.next(t)}}});if("function"!=typeof e)return(n=n.to)&&void 0!==e&&n.next(e),n;var i={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:e,the:n,on:this,as:o};return(i.back=n.last||n).to=i,n.last=i}})(_,"./onto"),_(function(t){var i="undefined"!=typeof setImmediate?setImmediate:setTimeout,r=[];t.exports=setTimeout.puff=function(t){r.length?r.push(t):(r=[t],i(function t(n){n=n||+new Date;for(var e,o=0;o<9&&(e=r[o++]);)e();if(console.STAT&&console.STAT(n,new Date-n,"puff"),e&&!(new Date-n))return t(n);(r=r.slice(o)).length&&i(t,0)},0))}})(_,"./puff"),_(function(t){if("undefined"==typeof JSON)throw new Error("JSON is not included in this browser. Please load it first: ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js");var r=JSON.stringify;t.exports=function(t,n,e,o,i){if(t<n)return{defer:!0};if(n<e)return{historical:!0};if(e<n)return{converge:!0,incoming:!0};if(n===e){if((o=r(o)||"")===(i=r(i)||""))return{state:!0};if(o<i)return{converge:!0,current:!0};if(i<o)return{converge:!0,incoming:!0}}return{err:"Invalid CRDT Data: "+o+" to "+i+" at "+n+" to "+e+"!"}}})(_,"./HAM"),_(function(t){var n=_("./type"),e={};function o(t,n){return this.id?this.id=!1:n==i&&u(t)?void(this.id=t):this.id=!1}e.is=function(t){return void 0!==t&&(null===t||t!==1/0&&(!!(u(t)||r(t)||a(t))||(e.link.is(t)||!1)))},e.link=e.rel={_:"#"},e.link.is=function(t){if(t&&t[i]&&!t._&&f(t)){var n={};if(l(t,o,n),n.id)return n.id}return!1},e.link.ify=function(t){return c({},i,t)},n.obj.has._=".";var i=e.link._,r=n.bi.is,a=n.num.is,u=n.text.is,s=n.obj,f=s.is,c=s.put,l=s.map;t.exports=e})(_,"./val"),_(function(t){var n=_("./type"),i=_("./val"),r={_:"_"};function a(t,n){if(n!==r._)return!i.is(t)||void(this.cb&&this.cb.call(this.as,t,n,this.n,this.s))}function o(t,n){var e,o=this.o;o.map?void 0===(e=o.map.call(this.as,t,""+n,o.node))?s(o.node,n):o.node&&(o.node[n]=e):i.is(t)&&(o.node[n]=t)}r.soul=function(t,n){return t&&t._&&t._[n||l]},r.soul.ify=function(t,n){return n="string"==typeof n?{soul:n}:n||{},(t=t||{})._=t._||{},t._[l]=n.soul||t._[l]||c(),t},r.soul._=i.link._,r.is=function(t,n,e){var o;return!!u(t)&&(!!(o=r.soul(t))&&!f(t,a,{as:e,cb:n,s:o,n:t}))},r.ify=function(t,n,e){return n?"string"==typeof n?n={soul:n}:"function"==typeof n&&(n={map:n}):n={},n.map&&(n.node=n.map.call(e,t,void 0,n.node||{})),(n.node=r.soul.ify(n.node||{},n))&&f(t,o,{o:n,as:e}),n.node};var e=n.obj,u=e.is,s=e.del,f=e.map,c=n.text.random,l=r.soul._;t.exports=r})(_,"./node"),_(function(t){var n=_("./type"),a=_("./node");function u(){var t;return t=+new Date,e=e<t?(o=0,t+u.drift):t+(o+=1)/i+u.drift}n.time.is;var e=-1/0,o=0,i=1e3,r="undefined"!=typeof performance&&(performance.timing&&performance),s=(r&&r.timing&&r.timing.navigationStart||(r=!1),u._=">");function f(t,n){k!==n&&u.ify(this.o,n,this.s)}u.drift=0,u.is=function(t,n,e){var o=n&&t&&t[k]&&t[k][s]||e;if(o)return v(o=o[n])?o:-1/0},u.lex=function(){return u().toString(36).replace(".","")},u.ify=function(t,n,e,o,i){if(!t||!t[k]){if(!i)return;t=a.soul.ify(t,i)}var r=l(t[k],s);return void 0!==n&&n!==k&&(v(e)&&(r[n]=e),void 0!==o&&(t[n]=o)),t},u.to=function(t,n,e){var o=(t||{})[n];return h(o)&&(o=g(o)),u.ify(e,n,u.is(t,n),o,a.soul(t))},u.map=function(i,r,a){var t=h(t=i||r)?t:null;return i=m(i=i||r)?i:null,t&&!i?(r=v(r)?r:u(),t[k]=t[k]||{},d(t,f,{o:t,s:r}),t):(a=a||h(r)?r:void 0,r=v(r)?r:u(),function(t,n,e,o){if(!i)return f.call({o:e,s:r},t,n),t;i.call(a||this||{},t,n,e,o),p(e,n)&&void 0===e[n]||f.call({o:e,s:r},t,n)})};var c=n.obj,l=c.as,p=c.has,h=c.is,d=c.map,g=c.copy,v=n.num.is,m=n.fn.is,k=a._;t.exports=u})(_,"./state"),_(function(t){var a=_("./type"),u=_("./val"),s=_("./node"),i={};function r(t,n){if(!t||n!==s.soul(t)||!s.is(t,this.fn,this.as))return!0;this.cb&&(e.n=t,e.as=this.as,this.cb.call(e.as,t,n,e))}function e(t){t&&s.is(e.n,t,e.as)}function f(t,n){var e;return(e=function(t,n){var e,o=t.seen,i=o.length;for(;i--;)if(e=o[i],n.obj===e.obj)return e;o.push(n)}(t,n))?e:(n.env=t,n.soul=c,s.ify(n.obj,o,n)&&(n.link=n.link||u.link.ify(s.soul(n.node)),n.obj!==t.shell&&(t.graph[u.link.is(n.link)]=n.node)),n)}function o(t,n,e){var o,i,r=this,a=r.env;if(s._===n&&g(t,u.link._))return e._;if(o=l(t,n,e,r,a)){if(n||(r.node=r.node||e||{},g(t,s._)&&s.soul(t)&&(r.node._=b(t._)),r.node=s.soul.ify(r.node,u.link.is(r.link)),r.link=r.link||u.link.ify(s.soul(r.node))),(i=a.map)&&(i.call(a.as||{},t,n,e,r),g(e,n))){if(void 0===(t=e[n]))return void d(e,n);if(!(o=l(t,n,e,r,a)))return}if(!n)return r.node;if(!0===o)return t;if((i=f(a,{obj:t,path:r.path.concat(n)})).node)return i.link}}function c(t){var n=this,e=u.link.is(n.link),o=n.env.graph;n.link=n.link||u.link.ify(t),n.link[u.link._]=t,n.node&&n.node[s._]&&(n.node[s._][u.link._]=t),g(o,e)&&(o[t]=o[e],d(o,e))}function l(t,n,e,o,i){var r;return!!u.is(t)||(h(t)?1:(r=i.invalid)?l(t=r.call(i.as||{},t,n,e),n,e,o,i):(i.err="Invalid value at '"+o.path.concat(n).join(".")+"'!",void(a.list.is(t)&&(i.err+=" Use `.set(item)` instead of an Array."))))}function p(t,n){var e,o;if(s._!==n)(e=u.link.is(t))?(o=this.opt.seen[e])?this.obj[n]=o:this.obj[n]=this.opt.seen[e]=i.to(this.graph,e,this.opt):this.obj[n]=t;else{if(v(t,u.link._))return;this.obj[n]=b(t)}}i.is=function(t,n,e,o){return!(!t||!h(t)||v(t))&&!k(t,r,{cb:n,fn:e,as:o})},i.ify=function(t,n,e){var o={path:[],obj:t};return n?"string"==typeof n?n={soul:n}:"function"==typeof n&&(n.map=n):n={},"string"==typeof e&&(n.soul=n.soul||e,e=void 0),n.soul&&(o.link=u.link.ify(n.soul)),n.shell=(e||{}).shell,n.graph=n.graph||{},n.seen=n.seen||[],n.as=n.as||e,f(n,o),n.root=o.node,n.graph},i.node=function(t){var n=s.soul(t);if(n)return m({},n,t)},i.to=function(t,n,e){if(t){var o={};return e=e||{seen:{}},k(t[n],p,{obj:o,graph:t,opt:e}),o}};a.fn.is;var n=a.obj,h=n.is,d=n.del,g=n.has,v=n.empty,m=n.put,k=n.map,b=n.copy;t.exports=i})(_,"./graph"),_(function(t){_("./onto"),t.exports=function(t,n){if(this.on){if("function"!=typeof t){if(!t||!n)return;var e=t["#"]||t,o=(this.tag||"")[e];if(!o)return;return o=this.on(e,n),clearTimeout(o.err),!0}e=n&&n["#"]||Math.random().toString(36).slice(2);if(!t)return e;var i=this.on(e,t,n);return i.err=i.err||setTimeout(function(){i.next({err:"Error: No ACK yet.",lack:!0}),i.off()},(this.opt||{}).lack||9e3),e}}})(_,"./ask"),_(function(t){var u=_("./type");t.exports=function(i){var r={s:{}},a=r.s;i=i||{max:1e3,age:27e3},r.check=function(t){return!!a[t]&&n(t)};var n=r.track=function(t){var n=a[t]||(a[t]={});return n.was=+new Date,r.to||(r.to=setTimeout(r.drop,i.age+9)),n};return r.drop=function(e){var o=+new Date;u.obj.map(a,function(t,n){t&&(e||i.age)>o-t.was||delete a[n]}),r.to=null,console.STAT&&9<(e=new Date-o)&&console.STAT(o,e,"dup drop")},r}})(_,"./dup"),_(function(t){function x(t){return t instanceof x?(this._={$:this}).$:this instanceof x?x.create(this._={$:this,opt:t}):new x(t)}x.is=function(t){return t instanceof x||t&&t._&&t===t._.$||!1},x.version=.202,(x.chain=x.prototype).toJSON=function(){};var n=_("./type");function r(t,n,e,o){var i=this,r=x.state.is(e,n);if(!r)return i.err="Error: No state on '"+n+"' in node '"+o+"'!";var a=i.graph[o]||G,u=x.state.is(a,n,!0),s=a[n],f=x.HAM(i.machine,r,u,t,s);f.incoming?(i.put[o]=x.state.to(e,n,i.put[o]),(i.diff||(i.diff={}))[o]=x.state.to(e,n,i.diff[o]),i.souls[o]=!0):f.defer&&(i.defer=r<(i.defer||1/0)?r:i.defer)}function a(t,n){var e=this,o=e.$._,i=(o.next||G)[n];if(!i){if(!(o.opt||G).super)return void(e.souls[n]=!1);i=e.$.get(n)._}var r=e.map[n]={put:t,get:n,$:i.$},a={ctx:e,msg:r};e.async=!!o.tag.node,e.ack&&(r["@"]=e.ack),m(t,u,a),e.async&&(e.and||o.on("node",function(t){this.to.next(t),t===e.map[t.get]&&(e.souls[t.get]=!1,m(t.put,s,t),m(e.souls,function(t){if(t)return t})||e.c||(e.c=1,this.off(),m(e.map,f,e)))}),e.and=!0,o.on("node",r))}function u(t,n){var e=this.ctx,o=e.graph,i=this.msg,r=i.get,a=i.put,u=i.$._;o[r]=x.state.to(a,n,o[r]),e.async||(u.put=x.state.to(a,n,u.put))}function s(t,n){var e=this.put,o=this.$._;o.put=x.state.to(e,n,o.put)}function f(t,n){t.$&&(this.cat.stop=this.stop,t.$._.on("in",t),this.cat.stop=null)}function c(t,n){if(t!==this.graph[n])return!0}n.obj.to(n,x),x.HAM=_("./HAM"),x.val=_("./val"),x.node=_("./node"),x.state=_("./state"),x.graph=_("./graph"),x.on=_("./onto"),x.ask=_("./ask"),x.dup=_("./dup"),x.puff=_("./puff"),function(){function f(t){if(t)if(t.out!==f){var n,e=this.as,o=e.at||e,i=o.$,r=o.dup,a=t.DBG;(n=t["#"])||(n=t["#"]=p(9)),r.check(n)||(r.track(n),n=t._,t._="function"==typeof n?n:function(){},t.$&&t.$===(t.$._||"").$||(t.$=i),o.ask(t["@"],t)||(a&&(a.u=+new Date),t.get&&x.on._get(t,i),!t.put)?(a&&(a.uc=+new Date),this.to.next(t),a&&(a.ua=+new Date),t.out=f,o.on("out",t),a&&(a.ue=+new Date)):u(t))}else this.to.next(t)}function u(t){if(t){var n,e,o=t._||"",i=o.root=((t.$||"")._||"").root,r=t.put,a=t["#"],u=o.DBG=t.DBG;if(r["#"])i.on("put",t);else{o.out=t,o.lot={s:0,more:1};var s=+new Date;for(var f in u&&(u.p=s),r){var c,l=r[f];if(!l){n=m+k(f)+"no node.";break}if(!(e=l._)){n=m+k(f)+"no meta.";break}if(f!==e[T]){n=m+k(f)+"soul not same.";break}if(!(c=e[A])){n=m+k(f)+"no state.";break}for(var p in l)if(S!==p){var h=l[p],d=c[p];if(w===d){n=m+k(p)+"on"+k(f)+"no state.";break}if(!D(h)){n=m+k(p)+"on"+k(f)+"bad "+typeof h+k(h);break}g(h,p,f,d,t)}if(n)break}u&&(u.pe=+new Date),console.STAT&&(console.STAT(s,new Date-s,"mix"),console.STAT(s,o.lot.s,"mix #")),(o.err=n)?i.on("in",{"@":a,err:x.log(n)}):(--o.lot.more||v(o),o.stun||t["@"]||i.on("in",{"@":a,ok:-1}))}}}function g(t,n,e,o,i){var r,a=i._||"",u=a.root,s=u.graph[e]||G,f=j(s,n,1),c=s[n],l=_(),p=b(l,o,f,t,c);if(p.incoming){(r=a.lot||"").s++,r.more++,(a.stun||(a.stun={}))[e+n]=1;var h=a.DBG;h&&(h.ph=h.ph||+new Date),u.on("put",{"#":i["#"],"@":i["@"],put:{"#":e,".":n,":":t,">":o},_:a})}else if(p.defer){var d=o-l;return setTimeout(function(){g(t,n,e,o,i)},y<d?y:d),a.to||u.on("in",{"@":i["#"],err:d}),a.to=1,d}}function e(t){var n;(n=(t._||"").DBG)&&(n.pa=+new Date,n.pm=n.pm||+new Date);var e,o=this.as.graph,i=t._,r=t.put,a=r["#"],u=r["."],s=r[":"],f=r[">"];t["#"];o[a]=$(o[a],u,f,s,a),function(t,n,e,o,i){var r,a,u=t.root;if((u.opt||"").super&&u.$.get(n),!(u&&(a=u.next)&&(a=a[n])&&a.$))return;(r=t.put||(t.put={}))[n]=$(r[n],e,i,o,n),a.put=$(a.put,e,i,o,n)}(i,a,u,w!==(e=r["="])?e:s,f),(e=i.out)&&(e=e.put)&&(e[a]=$(e[a],u,f,s,a)),--i.lot.more||v(i),this.to.next(t)}function v(t){if(!t.err){var n,e={},o=t.root,i=o.next||"",r=t.put,a=+new Date;for(var u in r){var s=r[u];(n=i[u])&&n.$&&(o.stop=e,n.on("in",{$:n.$,get:u,put:s}),o.stop=null)}console.STAT&&console.STAT(a,new Date-a,"fire"),t.DBG&&(t.DBG.f=+new Date),(n=t.out)&&(n.out=f,o.on("out",n))}}x.create=function(t){t.root=t.root||t,t.graph=t.graph||{},t.on=t.on||x.on,t.ask=t.ask||x.ask,t.dup=t.dup||x.dup();var n=t.$.opt(t.opt);return t.once||(t.on("in",f,t),t.on("out",f,t),t.on("put",e,t),x.on("create",t),t.on("create",t)),t.once=1,n},x.on.put=u;var m="Error: Invalid graph!",k=function(t){return" '"+(""+t).slice(0,9)+"...' "},b=x.HAM,y=2147483647,_=x.state}(),x.on._put=function(t,n){var e=n._,o={$:n,graph:e.graph,put:{},map:{},souls:{},machine:x.state(),ack:t["@"],cat:e,stop:{}};if(x.obj.map(t.put,c,o)){if(x.graph.is(t.put,null,r,o)||(o.err="Error: Invalid graph!"),o.err)return e.on("in",{"@":t["#"],err:x.log(o.err)});if(m(o.put,a,o),o.async||m(o.map,f,o),w!==o.defer){var i=o.defer-o.machine;setTimeout(function(){x.on._put(t,n)},i>MD?MD:i)}o.diff&&e.on("put",v(t,{put:o.diff}))}},x.on._get=function(t,n){var e=n._,o=t.get,i=o[T],r=e.graph[i],a=o[b],u=(e.next||(e.next={}))[i],s=(t._||"").DBG=t.DBG;if(s&&(s.g=+new Date),!r)return e.on("get",t);if(a){if("string"!=typeof a||!g(r,a))return e.on("get",t);r=x.state.to(r,a)}else r=x.window?x.obj.copy(r):r;r=x.graph.node(r),(u||G).ack;function f(){}f.ram=f.faith=!0,s&&(s.ga=+new Date),e.on("in",{"@":t["#"],put:r,ram:1,$:n,_:f}),s&&(s.gm=+new Date),e.on("get",t),s&&(s.gd=+new Date)},x.chain.opt=function(t){t=t||{};var n=this._,e=t.peers||t;return d(t)||(t={}),d(n.opt)||(n.opt=t),l(e)&&(e=[e]),o(e)&&(e=m(e,function(t,n,e){(n={}).id=n.url=t,e(t,n)}),d(n.opt.peers)||(n.opt.peers={}),n.opt.peers=v(e,n.opt.peers)),n.opt.peers=n.opt.peers||{},m(t,function t(n,e){!g(this,e)||i.is(n)||h.empty(n)?this[e]=n:n&&n.constructor!==Object&&!o(n)||m(n,t,this[e])},n.opt),x.on("opt",n),n.opt.uuid=n.opt.uuid||function(){return k()+p(12)},x.obj.native(),this},x.obj.native=function(){var t=Object.prototype;for(var n in t)console.log("Native Object.prototype polluted, reverting",n),delete t[n]};var w,e,o=x.list.is,i=x.text,l=i.is,p=i.random,h=x.obj,d=(h.empty,h.is),g=h.has,v=h.to,m=h.map,k=(h.copy,x.state.lex),$=x.state.ify,j=x.state.is,T=x.val.link._,b=".",S=x.node._,D=x.val.is,A=(x.val.link.is,x.state._),G={};(x.log=function(){return x.log.off||e.log.apply(e,arguments),[].slice.call(arguments).join(" ")}).once=function(t,n,e){return(e=x.log.once)[t]=e[t]||0,e[t]++||x.log(n)},"undefined"!=typeof window&&((window.GUN=window.Gun=x).window=window);try{void 0!==y&&(y.exports=x)}catch(t){}((t.exports=x).window||"").console=(x.window||"").console||{log:function(){}},(e=console).only=function(t,n){return e.only.i&&t===e.only.i&&e.only.i++&&(e.log.apply(e,arguments)||n)},x.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(_,"./root"),_(function(t){var u=_("./root");u.chain.back=function(t,n){if(-1===(t=t||1)||1/0===t)return this._.root.$;if(1===t)return(this._.back||this._).$;var e=this._;if("string"==typeof t&&(t=t.split(".")),t instanceof Array){for(var o=0,i=t.length,r=e;o<i;o++)r=(r||s)[t[o]];return void 0!==r?n?this:r:(r=e.back)?r.$.back(t,n):void 0}if("function"!=typeof t)return u.num.is(t)?(e.back||e).$.back(t-1):this;var a;for(r={back:e};(r=r.back)&&void 0===(a=t(r,n)););return a};var s={}})(_,"./back"),_(function(t){var s=_("./root");function r(t){var e,n,o=this.as,i=o.back,r=o.root;if(t.$||(t.$=o.$),this.to.next(t),e=t.get){if(o.lex&&(t.get=k(o.lex,t.get)),e["#"]||o.soul){if(e["#"]=e["#"]||o.soul,t["#"]||(t["#"]=y(9)),i=r.$.get(e["#"])._,e=e["."]){if(v(i.put,e)){if((n=(a=i.$.get(e)._).ack)||(a.ack=-1),i.on("in",{$:i.$,put:s.state.to(i.put,e),get:i.get}),n)return}else if("string"!=typeof e){var a={},u=(i.put||{})._;if(s.obj.map(i.put,function(t,n){s.text.match(n,e)&&(a[n]=t)}),s.obj.empty(a)||(a._=u,i.on("in",{$:i.$,put:a,get:i.get})),n=o.lex){if(n=n._||(n._=function(){}),i.ack<n.ask&&(n.ask=i.ack),n.ask)return;n.ask=1}}}else{if((n=i.ack)||(i.ack=-1),v(i,"put")&&i.on("in",i),n&&d!==i.put)return;t.$=i.$}return r.ask(h,t),r.on("in",t)}if(r.now&&(r.now[o.id]=r.now[o.id]||!0,o.pass={}),e["."])return o.get?(t={get:{".":o.get},$:o.$},i.ask||(i.ask={}),i.ask[o.get]=t.$._):t={get:{},$:o.$},i.on("out",t);if(o.ack=o.ack||-1,o.get)return t.$=o.$,e["."]=o.get,(i.ask||(i.ask={}))[o.get]=t.$._,i.on("out",t)}return i.on("out",t)}function a(t){var n,e,o=this,i=o.as,r=i.root,a=(t.$||g)._||g,u=t.put;if(i.get&&t.get!==i.get&&(t=k(t,{get:i.get})),i.has&&a!==i&&(t=k(t,{$:i.$}),a.ack&&(i.ack=a.ack)),d===u){if(e=a.put,o.to.next(t),i.soul)return;if(d===e&&d!==a.put)return;return c(i,t,o),i.has&&p(i,t),m(a.echo,i.id),void m(i.map,a.id)}if(i.soul)return o.to.next(t),c(i,t,o),void(i.next&&b(u,l,{msg:t,cat:i}));if(!(n=s.val.link.is(u)))return s.val.is(u)?(i.has||i.soul?p(i,t):(a.has||a.soul)&&((a.echo||(a.echo={}))[i.id]=a.echo[a.id]||i,(i.map||(i.map={}))[a.id]=i.map[a.id]||{at:a}),o.to.next(t),void c(i,t,o)):(i.has&&a!==i&&v(a,"put")&&(i.put=a.put),(n=s.node.soul(u))&&a.has&&(a.put=i.root.$.get(n)._.put),e=(r.stop||{})[a.id],o.to.next(t),f(i,t,a,n),c(i,t,o),void(i.next&&b(u,l,{msg:t,cat:i})));r.stop;(e=(e=r.stop||{})[a.id]||(e[a.id]={})).is=e.is||a.put,e[i.id]=a.put||!0,o.to.next(t),f(i,t,a,n),c(i,t,o)}function f(t,n,e,o){if(o&&u!==t.get){var i=t.root.$.get(o)._;t.has?e=i:e.has&&f(e,n,e,o),e!==t&&(e.$||(e={}),(e.echo||(e.echo={}))[t.id]=e.echo[t.id]||t,t.has&&!(t.map||g)[e.id]&&p(t,n),(o!==(i=e.id?(t.map||(t.map={}))[e.id]=t.map[e.id]||{at:e}:{}).link||i.pass||t.pass)&&(t.pass&&(s.obj.map(t.map,function(t){t.pass=!0}),m(t,"pass")),i.pass&&m(i,"pass"),t.has&&(t.link=o),function(t,o){var n=t.root.$.get(o)._,e=t.lex;if((t.ack||e)&&((e=e||{})["#"]=o,n.on("out",{get:e}),!t.ask))return;n=t.ask,s.obj.del(t,"ask"),b(n||t.next,function(t,n){var e=t.lex||{};e["#"]=o,e["."]=e["."]||n,t.on("out",{get:e})}),s.obj.del(t,"ask")}(t,i.link=o)))}}function c(t,n){t.echo&&b(t.echo,e,n)}function e(t){t&&t.on&&t.on("in",this)}function l(t,n){var e,o,i,r=this.cat.next||g,a=this.msg;(u!==n||r[n])&&(o=r[n])&&(o.has?(d!==o.put&&s.val.link.is(t)||(o.put=t),e=o.$):(i=a.$)&&(i=(e=a.$.get(n))._,d!==i.put&&s.val.link.is(t)||(i.put=t)),o.on("in",{put:t,get:n,$:e,via:a}))}function p(e,t){if(e.has||e.soul){var o=e.map;e.root;e.map=null,e.has&&(e.dub&&e.root.stop&&(e.dub=null),e.link=null),(e.pass||t["@"]||null!==o)&&(d===o&&s.val.link.is(e.put)||(b(o,function(t){(t=t.at)&&m(t.echo,e.id)}),o=e.put,b(e.next,function(t,n){if(d===o&&d!==e.put)return!0;t.put=d,t.ack&&(t.ack=-1),t.on("in",{get:n,$:t.$,put:d})})))}}function h(t,n){var e=this.as,o=e.get||"",i=e.$._,r=(t.put||"")[o["#"]];if(i.ack&&(i.ack=i.ack+1||1),t.put&&("string"!=typeof o["."]||v(r,i.get)))u!=o["."]?s.on.put(t):i.on("in",{get:i.get,put:s.val.link.ify(o["#"]),$:i.$,"@":t["@"]});else{if(i.put!==d)return;i.on("in",{get:i.get,put:i.put=d,$:i.$,"@":t["@"]})}}s.chain.chain=function(t){var n,e=this._,o=new(t||this).constructor(this),i=o._;return i.root=n=e.root,i.id=++n.once,i.back=this._,i.on=s.on,i.on("in",a,i),i.on("out",r,i),o};var d,g={},n=s.obj,v=n.has,m=(n.put,n.del),k=n.to,b=n.map,y=s.text.random,u=(s.val.link._,s.node._)})(_,"./chain"),_(function(t){var f=_("./root");function c(t){var n,e=this,o=e.as,i=o.at.root,r=(t.$||{})._||{},a=t.put||r.put;if((n=i.now)&&e!==n[o.now])return e.to.next(t);if(e.seen&&r.id&&e.seen[r.id])return e.to.next(t);if((n=a)&&n[g._]&&(n=g.is(n))&&(n=(t.$$=r.root.$.get(n))._,p!==n.put&&(t=s(t,{put:a=n.put}))),(n=i.mum)&&r.id){var u=r.id+(e.id||(e.id=f.text.random(9)));if(n[u])return;p===a||g.is(a)||(n[u]=!0)}o.use(t,e),e.stun?e.stun=null:e.to.next(t)}function l(t){var n=this.on;if(!t||n.soul||n.has)return this.off();if(t=(t=(t=t.$||t)._||t).id){var e;n.map;if((e=this.seen||(this.seen={}))[t])return!0;e[t]=!0}}f.chain.get=function(t,n,e){var o;if("string"!=typeof t){if("function"!=typeof t)return d(t)?this.get(""+t,n,e):(u=g.is(t))?this.get(u,n,e):h.is(t)?(o=this,(u=((u=t["#"])||m)["="]||u)&&(o=o.get(u)),o._.lex=t,o):((e=this.chain())._.err={err:f.log("Invalid get request!",t)},n&&n.call(e,e._.err),e);if(!0===n)return function(t,n,e){var a,u=t._,s=0;if(a=u.soul||u.link||u.dub)return n(a,e,u);if(u.jam)return u.jam.push([n,e]);u.jam=[[n,e]],t.get(function(t,n){if(!(p===t.put&&(a=Object.keys(u.root.opt.peers).length)&&++s<a)){n.rid(t);var e,o=(o=t.$)&&o._||{},i=0;for(a=u.jam,delete u.jam;e=a[i++];){var r=e[0];e=e[1],r&&r(o.link||o.soul||g.is(t.put)||v(t.put)||o.dub,e,t,n)}}},{out:{get:{".":!0}}})}(this,t,e),this;var i,r=(o=this)._,a=r.root,u=a.now;(e=n||{}).at=r,e.use=t,e.out=e.out||{},e.out.get=e.out.get||{},(i=r.on("in",c,e)).rid=l,(a.now={$:1})[e.now=r.id]=i;var s=a.mum;return a.mum={},r.on("out",e.out),a.mum=s,a.now=u,o}return(o=(this._.next||m)[t])||(o=function(t,n){var e=n._,o=e.next,i=n.chain()._;o=o||(e.next={});o[i.get=t]=i,n===e.root.$?i.soul=t:(e.soul||e.has)&&(i.has=t);return i}(t,this)),o=o.$,(u=this._.stun)&&(o._.stun=o._.stun||u),n&&"function"==typeof n&&o.get(n,e),o};var p,h=f.obj,s=(h.map,h.has,f.obj.to),d=f.num.is,g=f.val.link,v=f.node.soul,m=(f.node._,{})})(_,"./get"),_(function(t){var f=_("./root");function u(t){t&&t()}function s(){var r=this;r.graph&&n(r.stun)&&(r.res=r.res||function(t){t&&t()},r.res(function(){var n=r.$.back(-1)._,t=n.ask(function(t){n.root.on("ack",t),t.err&&f.log(t),++e>(r.acks||0)&&this.off(),r.ack&&r.ack(t,this)},r.opt),e=0,o=n.root.now;h.del(n.root,"now");var i=n.root.mum;n.root.mum={},r.ref._.on("out",{$:r.ref,put:r.out=r.env.graph,opt:r.opt,"#":t}),n.root.mum=i?h.to(i,n.root.mum):i,n.root.now=o},r),r.res&&r.res())}function c(r,t,n,a){var u=this,s=f.is(r);!t&&a.path.length&&(u.res||e)(function(){for(var t=a.path,n=u.ref,e=(u.opt,0),o=t.length;e<o;e++)n=n.get(t[e]);s&&(n=r);var i=n._.dub;if(i=i||f.node.soul(a.obj))return n.back(-1).get(i),void a.soul(i);(u.stun=u.stun||{})[t]=1,n.get(l,!0,{as:{at:a,as:u,p:t}})},{as:u,at:a})}function l(t,e,n,o){var i=(e=e.as).at;e=e.as;var r=((n||{}).$||{})._||{};t=r.dub=r.dub||t||f.node.soul(i.obj)||f.node.soul(n.put||r.put)||f.val.link.is(n.put||r.put)||(e.via.back("opt.uuid")||f.text.random)(),o&&(o.stun=!0),t?a(r,r.dub=t,i,e):e.via.back("opt.uuid")(function(t,n){if(t)return f.log(t);a(r,r.dub=r.dub||n,i,e)})}function a(t,n,e,o){t.$.back(-1).get(n),e.soul(n),delete o.stun[e.path],o.batch()}function p(t,e,n,o){if(e=e.as,n.$&&n.$._)if(n.err)f.log("Please report this as an issue! Put.any.err");else{var i,r=n.$._,a=r.put,u=e.opt||{};if(!(i=e.ref)||!i._.now){if(o&&(o.stun=!0),e.ref!==e.$){if(!(i=e.$._.get||r.get))return void f.log("Please report this as an issue! Put.no.get");e.data=g({},i,e.data),i=null}if(void 0===a){if(!r.get)return;t||(i=r.$.back(function(t){if(t.link||t.soul)return t.link||t.soul;e.data=g({},t.get,e.data)}),e.not=!0),r=(i=i||r.soul||r.link||r.dub)?r.root.$.get(i)._:r,e.soul=i,a=e.data}e.not||(e.soul=e.soul||t)||(e.path&&d(e.data)?e.soul=(u.uuid||e.via.back("opt.uuid")||f.text.random)():(k==r.get&&(e.soul=(r.put||v)["#"]||r.dub),e.soul=e.soul||r.soul||r.link||(u.uuid||e.via.back("opt.uuid")||f.text.random)()),e.soul)?e.ref.put(e.data,e.soul,e):e.via.back("opt.uuid")(function(t,n){if(t)return f.log(t);e.ref.put(e.data,e.soul=n,e)})}}}f.chain.put=function(t,o,i){var n,r=this,e=r._,a=e.root.$;a._;return(i=i||{}).data=t,i.via=i.$=i.via||i.$||r,"string"==typeof o?i.soul=o:i.ack=i.ack||o,e.soul&&(i.soul=e.soul),i.soul||a===r?d(i.data)?(i.soul=i.soul||(i.not=f.node.soul(i.data)||(i.via.back("opt.uuid")||f.text.random)()),i.soul?(i.$=a.get(i.soul),i.ref=i.$,function(t){t.batch=s;var n=t.opt||{},e=t.env=f.state.map(c,n.state);if(e.soul=t.soul,t.graph=f.graph.ify(t.data,e,t),e.err)return(t.ack||m).call(t,t.out={err:f.log(e.err)}),t.res&&t.res();t.batch()}(i)):i.via.back("opt.uuid")(function(t,n){if(t)return f.log(t);(i.ref||i.$).put(i.data,i.soul=n,i)}),r):((i.ack||m).call(i,i.out={err:f.log("Data saved to the root level of the graph must be a node (an object), not a",typeof i.data,'of "'+i.data+'"!')}),i.res&&i.res(),r):f.is(t)?(t.get(function(t,n,e){if(!t)return f.log("The reference you are saving is a",typeof e.put,'"'+e.put+'", not a node (object)!');r.put(f.val.link.ify(t),o,i)},!0),r):(e.has&&(n=f.val.link.is(t))&&(e.dub=n),i.ref=i.ref||a._===(n=e.back)?r:n.$,i.ref._.soul&&f.val.is(i.data)&&e.get?(i.data=g({},e.get,i.data),i.ref.put(i.data,i.soul,i)):(i.ref.get(p,!0,{as:i}),i.out||(i.res=i.res||u,i.$._.stun=i.ref._.stun)),r)};var h=f.obj,d=h.is,g=h.put,n=(h.map,h.empty),v={},m=function(){},e=function(t,n){t.call(n||v)},k=f.node._})(_,"./put"),_(function(t){var n=_("./root");_("./chain"),_("./back"),_("./put"),_("./get"),t.exports=n})(_,"./index"),_(function(t){var f=_("./index");function u(t,n){var e,o=this,i=t.$,r=((i||{})._||{}).put||t.put;o.at;if(l!==r){if(e=t.$$){if(e=t.$$._,l===e.put)return;r=e.put}o.change&&(r=t.put),o.as?o.ok.call(o.as,t,n):o.ok.call(i,r,t.get,t,n)}}function c(t,n,e){if(t.$){var o,i,r=this.as,a=(r.at,t.$),u=a._,s=u.put||t.put;(i=t.$$)&&(o=i=t.$$._,l!==o.put&&(s=o.put)),(i=n.wait)&&(i=i[u.id])&&clearTimeout(i),n.ack=(n.ack||0)+1,!e&&l===s&&n.ack<=(r.acks||Object.keys(u.root.opt.peers).length)||(!e&&(l===s||u.soul||u.link||o&&!(0<o.ack))||l===s&&(i=Object.keys(u.root.opt.peers).length)&&!e&&(o||u).ack<i?i=(n.wait={})[u.id]=setTimeout(function(){c.call({as:r},t,n,i||1)},r.wait||99):(o&&l===o.put&&(i=p.is(s))&&(s=f.node.ify({},i)),n.rid?n.rid(t):n.off(),r.ok.call(a||r.$,s,t.get)))}else n.off()}f.chain.on=function(t,n,e,o){var i,r=this._;if("string"==typeof t)return n?(i=r.on(t,n,e||r,o),e&&e.$&&(e.subs||(e.subs=[])).push(i),this):r.on(t);var a=n;return(a=!0===a?{change:!0}:a||{}).at=r,a.ok=t,this.get(u,a),this},f.chain.val=function(t,n){return f.log.once("onceval","Future Breaking API Change: .val -> .once, apologies unexpected."),this.once(t,n)},f.chain.once=function(t,n){var e=this,o=e._,i=o.put;if(0<o.ack&&l!==i)return(t||a).call(e,i,o.get),e;if(t)return(n=n||{}).ok=t,n.at=o,n.out={"#":f.text.random(9)},e.get(c,{as:n}),n.async=!0,e;f.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it.");var r=e.chain();return r._.nix=e.once(function(){r._.on("in",e._)}),r},f.chain.off=function(){var t,n=this._,e=n.back;if(e)return n.ack=0,(t=e.next)&&t[n.get]&&i(t,n.get),(t=e.ask)&&i(t,n.get),(t=e.put)&&i(t,n.get),(t=n.soul)&&i(e.root.graph,t),(t=n.map)&&o(t,function(t){t.link&&e.root.$.get(t.link).off()}),(t=n.next)&&o(t,function(t){t.$.off()}),n.on("off",{}),this};var l,n=f.obj,o=n.map,i=(n.has,n.del),p=(n.to,f.val.link),a=function(){}})(_,"./on"),_(function(t){var u=_("./index");function i(t){if(!t.put||u.val.is(t.put))return this.to.next(t);this.as.nix&&this.off(),e(t.put,n,{at:this.as,msg:t}),this.to.next(t)}function n(t,n){if(a!==n){var e=this.msg.$,o=e._,i=this.at,r=o.lex;r&&!u.text.match(n,r["."]||r["#"]||r)||(((r=e.get(n)._).echo||(r.echo={}))[i.id]=r.echo[i.id]||i)}}u.chain.map=function(r,t,n){var a,e=this,o=e._;return r?(u.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),a=e.chain(),e.map().on(function(t,n,e,o){var i=(r||s).call(this,t,n,e,o);if(void 0!==i)return t===i?a._.on("in",e):u.is(i)?a._.on("in",i._):void a._.on("in",{get:n,put:i})})):(a=o.each)||(o.each=a=e.chain(),a._.nix=e.back("nix"),e.on("in",i,a._)),a};var e=u.obj.map,s=function(){},a=u.node._})(_,"./map"),_(function(t){var a=_("./index");a.chain.set=function(t,o,i){var n,r=this;return o=o||function(){},(i=i||{}).item=i.item||t,(n=a.node.soul(t))&&(t=a.obj.put({},n,a.val.link.ify(n))),a.is(t)?(t.get(function(t,n,e){if(!t)return o.call(r,{err:a.log('Only a node can be linked! Not "'+e.put+'"!')});r.put(a.obj.put({},t,a.val.link.ify(t)),o,i)},!0),t):(a.obj.is(t)&&(t=r.back(-1).get(n=n||a.node.soul(t)||r.back("opt.uuid")()).put(t)),r.get(n||a.state.lex()+a.text.random(7)).put(t,o,i))}})(_,"./set"),_(function(t){if("undefined"!=typeof Gun){var h;try{h=(Gun.window||function(){}).localStorage}catch(t){}h||(Gun.log("Warning: No localStorage exists to persist data to!"),h={setItem:function(t,n){this[t]=n},removeItem:function(t){delete this[t]},getItem:function(t){return this[t]}}),Gun.on("create",function(t){var n=this.to,e=t.opt;if(t.once)return n.next(t);if(!1===e.localStorage)return n.next(t);e.prefix=e.file||"gun/";var i,o,r=Gun.obj.ify(h.getItem("gap/"+e.prefix))||{},a=Gun.obj.empty;if(!a(r)){var u=Gun.obj.ify(h.getItem(e.prefix))||{},s={};Gun.obj.map(r,function(t,e){Gun.obj.map(t,function(t,n){s[e]=Gun.state.to(u[e],n,s[e])})}),setTimeout(function(){t.on("out",{put:s,"#":t.ask(f)})},1)}function f(t){if(!t.err&&t.ok){var o=t["@"];setTimeout(function(){Gun.obj.map(r,function(e,t){Gun.obj.map(e,function(t,n){o===t&&delete e[n]}),a(e)&&delete r[t]}),l()},e.wait||1)}}t.on("out",function(t){t.lS||(Gun.is(t.$)&&t.put&&!t["@"]&&(i=t["#"],Gun.graph.is(t.put,null,c),o=o||setTimeout(l,e.wait||1)),this.to.next(t))}),t.on("ack",f),n.next(t);var c=function(t,n,e,o){(r[o]||(r[o]={}))[n]=i},l=function(){clearTimeout(o),o=!1;try{h.setItem("gap/"+e.prefix,JSON.stringify(r))}catch(t){Gun.log(err=t||"localStorage failure")}}}),Gun.on("create",function(a){this.to.next(a);var u=a.opt;if(!a.once&&!1!==u.localStorage){u.prefix=u.file||"gun/";a.graph;var s,f={},c=0,l=Gun.obj.ify(h.getItem(u.prefix))||{};a.on("localStorage",l),a.on("put",function(t){this.to.next(t);var n,e=t.put,o=e["#"],i=e["."],r=e[":"],a=e[">"];if(l[o]=Gun.state.ify(l[o],i,a,r,o),t["@"]||((f[t["#"]]=n=(t._||"").lot||{}).lS=(n.lS||0)+1),(c+=1)>=(u.batch||1e3))return p();s=s||setTimeout(p,u.wait||1)}),a.on("get",function(n){this.to.next(n);var e,o,i,r=n.get;function t(){if(r&&(e=r["#"])){var t=r["."];(o=l[e]||i)&&t&&(o=Gun.state.to(o,t)),a.on("in",{"@":n["#"],put:Gun.graph.node(o),lS:1})}}Gun.debug?setTimeout(t,1):t()});var p=function(t){var e;c=0,clearTimeout(s),s=!1;var n=f;f={},t&&(l=t);try{h.setItem(u.prefix,JSON.stringify(l))}catch(t){Gun.log(e=(t||"localStorage failure")+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),a.on("localStorage:error",{err:e,file:u.prefix,flush:l,retry:p})}(e||Gun.obj.empty(u.peers))&&Gun.obj.map(n,function(t,n){if(t){if(t.more)return void(f[n]=t);t.s!==t.lS&&(e="localStorage batch not same.")}a.on("in",{"@":n,err:e,ok:0})})}}})}})(_,"./adapters/localStorage"),_(function(t){var x=_("../type");!function(){x.text.hash=function(t){if("string"!=typeof t)return{err:1};var n=0;if(!t.length)return n;for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n};var e=JSON.stringify;function o(t,n){var e;if(!(n instanceof Object))return n;var o=+new Date;return x.obj.map(Object.keys(n).sort(),i,{to:e={},on:n}),console.STAT&&console.STAT(o,new Date-o,"sort"),e}function i(t){this.to[t]=this.on[t]}x.obj.hash=function(t,n){if(n||void 0!==(t=e(t,o)))return x.text.hash(n||t||"")},x.obj.hash.sort=o}();var w=x.obj.is;x.obj.map;try{t.exports=function(f){var l=function(){},p=f.opt||{};p.log=p.log||console.log,p.gap=p.gap||p.wait||0,p.pack=p.pack||.3*(p.memory?1e3*p.memory*1e3:1399e6),p.puff=p.puff||9;var h,d,g,v=setTimeout.puff||setTimeout,m=f.dup,c=m.check,k=m.track,b=l.hear=function(t,i){if(t){if(p.pack<=t.length)return l.say({dam:"!",err:"Message too big!"},i);var r,n,e,o=t[0];if(l===this&&(b.d+=t.length||0,++b.c),"["!==o){if("{"===o||(t["#"]||w(t))&&(r=t)){try{r=r||JSON.parse(t)}catch(t){return p.log("DAM JSON parse error",t)}if(!r)return;if(r.DBG&&(r.DBG=e={DBG:r.DBG}),e&&(e.hp=+new Date),(n=r["#"])||(n=r["#"]=x.text.random(9)),o=c(n))return;if((r._=function(){}).via=l.leap=i,o=r.dam)return(o=l.hear[o])&&o(r,i,f),void k(n);var a,u=+new Date;e&&(e.is=u),f.on("in",r),e&&(e.hd=+new Date),console.STAT&&9<(a=new Date-u)&&console.STAT(u,a,"msg"),k(n).via=i,l.leap=null}}else{try{r=JSON.parse(t)}catch(t){p.log("DAM JSON parse error",t)}if(t="",!r)return;console.STAT&&console.STAT(+new Date,r.length,"# on hear batch");var s=p.puff;(function t(){for(var n,e=+new Date,o=0;o<s&&(n=r[o++]);)b(n,i);r=r.slice(o),console.STAT&&console.STAT(e,new Date-e,"hear loop"),y(i),r.length&&v(t,0)})()}}};function y(t){var n=t.batch,e="string"==typeof n;if(e&&(n+="]"),t.batch=t.tail=null,n&&(e?!(n.length<3):n.length)){if(!e)try{n=1===n.length?n[0]:JSON.stringify(n)}catch(t){return p.log("DAM JSON stringify error",t)}n&&_(n,t)}}function _(n,e){try{var t=e.wire;e.say?e.say(n):t.send&&t.send(n),l.say.d+=n.length||0,++l.say.c}catch(t){(e.queue=e.queue||[]).push(n)}}b.c=b.d=0,d=0,g=l.say=function(r,t){if(this.to&&this.to.next(r),!r)return!1;var n,e,a,o=r.DBG;t||(s=+new Date,o&&(o.y=s));var u=r._||(r._=function(){});if((n=r["#"])||(n=r["#"]=x.text.random(9)),(a=u.raw)||(a=l.raw(r)),s&&console.STAT&&console.STAT(s,new Date-s,"say prep"),h||k(n),!t&&(e=r["@"])&&(t=(e=m.s[e])&&(e.via||(e=e.it)&&(e=e._)&&e.via)||l.leap),!t&&r["@"])return console.STAT&&console.STAT(+new Date,++d,"total no peer to ack to"),!1;if(!t&&l.way)return l.way(r);if(t&&t.id){if(!t.wire&&l.wire&&l.wire(t),n!==t.last){if(t.last=n,t===u.via)return!1;if((e=u.to)&&(e[t.url]||e[t.pid]||e[t.id]))return!1;if(t.batch){if(t.tail=(e=t.tail||0)+a.length,t.tail<=p.pack)return void(t.batch+=(e?",":"")+a);y(t)}t.batch="[";var i,s=+new Date;setTimeout(function(){console.STAT&&9<(i=new Date-s)&&console.STAT(s,i,"0ms TO",n,t.id),y(t)},p.gap),_(a,t)}}else{if(!x.obj.is(t||p.peers))return!1;p.puff;var f=p.peers,c=Object.keys(t||p.peers||{});(function t(){var n=+new Date;h=1;var e=u.raw;u.raw=a;for(var o,i=0;i<9&&(o=(c||"")[i++]);)(o=f[o])&&g(r,o);u.raw=e,h=0,c=c.slice(i),console.STAT&&console.STAT(n,new Date-n,"say loop"),c.length&&(v(t,0),k(r["@"]))})()}},l.say.c=l.say.d=0,function(){l.raw=function(t){if(!t)return"";var n,e=t._||{};if(n=e.raw)return n;if("string"==typeof t)return t;var o=i(t);return e&&(o||"").length<1e5&&(e.raw=o),o};var i=JSON.stringify}(),l.hi=function(n){var t=n.wire||{};n.id?p.peers[n.url||n.id]=n:(t=n.id=n.id||x.text.random(9),l.say({dam:"?",pid:f.opt.pid},p.peers[t]=n),delete m.s[n.last]),n.met=n.met||+new Date,t.hied||f.on(t.hied="hi",n),t=n.queue,n.queue=[],x.obj.map(t,function(t){_(t,n)}),x.obj.native&&x.obj.native()},l.bye=function(t){f.on("bye",t);var n=+new Date;n-=t.met||n,l.bye.time=((l.bye.time||n)+n)/2},l.hear["!"]=function(t,n){p.log("Error:",t.err)},l.hear["?"]=function(t,n){t.pid&&(n.pid||(n.pid=t.pid),t["@"])||(l.say({dam:"?",pid:p.pid,"@":t["#"]},n),delete m.s[n.last])},f.on("create",function(t){t.opt.pid=t.opt.pid||x.text.random(9),this.to.next(t),t.on("out",l.say)}),f.on("bye",function(t,n){t=p.peers[t.id||t]||t,this.to.next(t),t.bye?t.bye():(n=t.wire)&&n.close&&n.close(),x.obj.del(p.peers,t.id),t.wire=null});var i={};return f.on("bye",function(t,n){this.to.next(t),(n=t.url)&&(i[n]=!0,setTimeout(function(){delete i[n]},p.lack||9e3))}),f.on("hi",function(e,o){this.to.next(e),(o=e.url)&&i[o]&&(delete i[o],p.super||x.obj.map(f.next,function(t,n){(o={})[n]=f.graph[n],l.say({"##":x.obj.hash(o),get:{"#":n}},e)}))}),l}}catch(t){}})(_,"./adapters/mesh"),_(function(t){var f=_("../index");f.Mesh=_("./mesh"),f.on("opt",function(t){this.to.next(t);var o=t.opt;if(!t.once&&!1!==o.WebSocket){var n;"undefined"!=typeof window&&(n=window),"undefined"!=typeof global&&(n=global),n=n||{};var e=o.WebSocket||n.WebSocket||n.webkitWebSocket||n.mozWebSocket;if(e){o.WebSocket=e;var i=o.mesh=o.mesh||f.Mesh(t);i.wire||o.wire;i.wire=o.wire=u,setTimeout(function(){t.on("out",{dam:"hi"})},1);var r=2e3,a="undefined"!=typeof document&&document}}function u(n){try{if(!n||!n.url)return e&&e(n);var t=n.url.replace("http","ws"),e=n.wire=new o.WebSocket(t);return e.onclose=function(){o.mesh.bye(n),s(n)},e.onerror=function(t){s(n)},e.onopen=function(){o.mesh.hi(n)},e.onmessage=function(t){t&&o.mesh.hear(t.data||t,n)},e}catch(t){}}function s(n){clearTimeout(n.defer),a&&n.retry<=0||(n.retry=(n.retry||o.retry||60)-1,n.defer=setTimeout(function t(){if(a&&a.hidden)return setTimeout(t,r);u(n)},r))}})})(_,"./adapters/websocket")}();
(function(){function USE(arg,req){return req?require(arg):arg.slice?USE[R(arg)]:function(mod,path){arg(mod={exports:{}});USE[R(path)]=mod.exports}
function R(p){return p.split('/').slice(-1).toString().replace('.js','')}}
if(typeof module!=="undefined"){var MODULE=module};USE(function(module){if(typeof window!=="undefined"){module.window=window}
var tmp=module.window||module;var SEA=tmp.SEA||{};if(SEA.window=module.window){SEA.window.SEA=SEA}
try{if(typeof MODULE!=="undefined"){MODULE.exports=SEA}}catch(e){}
module.exports=SEA})(USE,'./root');USE(function(module){var SEA=USE('./root');try{if(SEA.window){if(location.protocol.indexOf('s')<0&&location.host.indexOf('localhost')<0&&location.protocol.indexOf('file:')<0){location.protocol='https:'}}}catch(e){}})(USE,'./https');USE(function(module){if(typeof btoa==="undefined"){if(typeof Buffer==="undefined"){global.Buffer=require("buffer").Buffer}
global.btoa=function(data){return Buffer.from(data,"binary").toString("base64")};global.atob=function(data){return Buffer.from(data,"base64").toString("binary")}}})(USE,'./base64');USE(function(module){USE('./base64');function SeaArray(){}
Object.assign(SeaArray,{from:Array.from})
SeaArray.prototype=Object.create(Array.prototype)
SeaArray.prototype.toString=function(enc,start,end){enc=enc||'utf8';start=start||0;const length=this.length
if(enc==='hex'){const buf=new Uint8Array(this)
return[...Array(((end&&(end+1))||length)-start).keys()].map((i)=>buf[i+start].toString(16).padStart(2,'0')).join('')}
if(enc==='utf8'){return Array.from({length:(end||length)-start},(_,i)=>String.fromCharCode(this[i+start])).join('')}
if(enc==='base64'){return btoa(this)}}
module.exports=SeaArray})(USE,'./array');USE(function(module){USE('./base64');var SeaArray=USE('./array');function SafeBuffer(...props){console.warn('new SafeBuffer() is depreciated, please use SafeBuffer.from()')
return SafeBuffer.from(...props)}
SafeBuffer.prototype=Object.create(Array.prototype)
Object.assign(SafeBuffer,{from(){if(!Object.keys(arguments).length||arguments[0]==null){throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')}
const input=arguments[0]
let buf
if(typeof input==='string'){const enc=arguments[1]||'utf8'
if(enc==='hex'){const bytes=input.match(/([\da-fA-F]{2})/g).map((byte)=>parseInt(byte,16))
if(!bytes||!bytes.length){throw new TypeError('Invalid first argument for type \'hex\'.')}
buf=SeaArray.from(bytes)}else if(enc==='utf8'){const length=input.length
const words=new Uint16Array(length)
Array.from({length:length},(_,i)=>words[i]=input.charCodeAt(i))
buf=SeaArray.from(words)}else if(enc==='base64'){const dec=atob(input)
const length=dec.length
const bytes=new Uint8Array(length)
Array.from({length:length},(_,i)=>bytes[i]=dec.charCodeAt(i))
buf=SeaArray.from(bytes)}else if(enc==='binary'){buf=SeaArray.from(input)}else{console.info('SafeBuffer.from unknown encoding: '+enc)}
return buf}
const byteLength=input.byteLength
const length=input.byteLength?input.byteLength:input.length
if(length){let buf
if(input instanceof ArrayBuffer){buf=new Uint8Array(input)}
return SeaArray.from(buf||input)}},alloc(length,fill=0){return SeaArray.from(new Uint8Array(Array.from({length:length},()=>fill)))},allocUnsafe(length){return SeaArray.from(new Uint8Array(Array.from({length:length})))},concat(arr){if(!Array.isArray(arr)){throw new TypeError('First argument must be Array containing ArrayBuffer or Uint8Array instances.')}
return SeaArray.from(arr.reduce((ret,item)=>ret.concat(Array.from(item)),[]))}})
SafeBuffer.prototype.from=SafeBuffer.from
SafeBuffer.prototype.toString=SeaArray.prototype.toString
module.exports=SafeBuffer})(USE,'./buffer');USE(function(module){const SEA=USE('./root')
const Buffer=USE('./buffer')
const api={Buffer:Buffer}
var o={};if(SEA.window){api.crypto=navigator&&navigator.product==='ReactNative'?require('isomorphic-webcrypto'):window.crypto||window.msCrypto||require('isomorphic-webcrypto');api.subtle=(api.crypto||o).subtle||(api.crypto||o).webkitSubtle;api.TextEncoder=window.TextEncoder;api.TextDecoder=window.TextDecoder;api.random=(len)=>Buffer.from(api.crypto.getRandomValues(new Uint8Array(Buffer.alloc(len))))}
if(!api.TextDecoder)
{const{TextEncoder,TextDecoder}=require('text-encoding');api.TextDecoder=TextDecoder;api.TextEncoder=TextEncoder}
if(!api.crypto){try{var crypto=USE('crypto',1);Object.assign(api,{crypto,random:(len)=>Buffer.from(crypto.randomBytes(len))});const isocrypto=require('isomorphic-webcrypto');api.ossl=api.subtle=isocrypto.subtle}catch(e){console.log("text-encoding and @peculiar/webcrypto may not be included by default, please add it to your package.json!");TEXT_ENCODING_OR_PECULIAR_WEBCRYPTO_NOT_INSTALLED}}
module.exports=api})(USE,'./shim');USE(function(module){var SEA=USE('./root');var Buffer=USE('./buffer');var s={};s.pbkdf2={hash:{name:'SHA-256'},iter:100000,ks:64};s.ecdsa={pair:{name:'ECDSA',namedCurve:'P-256'},sign:{name:'ECDSA',hash:{name:'SHA-256'}}};s.ecdh={name:'ECDH',namedCurve:'P-256'};s.jwk=function(pub,d){pub=pub.split('.');var x=pub[0],y=pub[1];var jwk={kty:"EC",crv:"P-256",x:x,y:y,ext:!0};jwk.key_ops=d?['sign']:['verify'];if(d){jwk.d=d}
return jwk};s.keyToJwk=function(keyBytes){const keyB64=keyBytes.toString('base64');const k=keyB64.replace(/\+/g,'-').replace(/\//g,'_').replace(/\=/g,'');return{kty:'oct',k:k,ext:!1,alg:'A256GCM'}}
s.recall={validity:12*60*60,hook:function(props){return props}};s.check=function(t){return(typeof t=='string')&&('SEA{'===t.slice(0,4))}
s.parse=function p(t){try{var yes=(typeof t=='string');if(yes&&'SEA{'===t.slice(0,4)){t=t.slice(3)}
return yes?JSON.parse(t):t}catch(e){}
return t}
SEA.opt=s;module.exports=s})(USE,'./settings');USE(function(module){var shim=USE('./shim');module.exports=async function(d,o){var t=(typeof d=='string')?d:JSON.stringify(d);var hash=await shim.subtle.digest({name:o||'SHA-256'},new shim.TextEncoder().encode(t));return shim.Buffer.from(hash)}})(USE,'./sha256');USE(function(module){const __shim=USE('./shim')
const subtle=__shim.subtle
const ossl=__shim.ossl?__shim.ossl:subtle
const sha1hash=(b)=>ossl.digest({name:'SHA-1'},new ArrayBuffer(b))
module.exports=sha1hash})(USE,'./sha1');USE(function(module){var SEA=USE('./root');var shim=USE('./shim');var S=USE('./settings');var sha=USE('./sha256');var u;SEA.work=SEA.work||(async(data,pair,cb,opt)=>{try{var salt=(pair||{}).epub||pair;var opt=opt||{};if(salt instanceof Function){cb=salt;salt=u}
data=(typeof data=='string')?data:JSON.stringify(data);if('sha'===(opt.name||'').toLowerCase().slice(0,3)){var rsha=shim.Buffer.from(await sha(data,opt.name),'binary').toString(opt.encode||'base64')
if(cb){try{cb(rsha)}catch(e){console.log(e)}}
return rsha}
salt=salt||shim.random(9);var key=await(shim.ossl||shim.subtle).importKey('raw',new shim.TextEncoder().encode(data),{name:opt.name||'PBKDF2'},!1,['deriveBits']);var work=await(shim.ossl||shim.subtle).deriveBits({name:opt.name||'PBKDF2',iterations:opt.iterations||S.pbkdf2.iter,salt:new shim.TextEncoder().encode(opt.salt||salt),hash:opt.hash||S.pbkdf2.hash,},key,opt.length||(S.pbkdf2.ks*8))
data=shim.random(data.length)
var r=shim.Buffer.from(work,'binary').toString(opt.encode||'base64')
if(cb){try{cb(r)}catch(e){console.log(e)}}
return r}catch(e){console.log(e);SEA.err=e;if(SEA.throw){throw e}
if(cb){cb()}
return}});module.exports=SEA.work})(USE,'./work');USE(function(module){var SEA=USE('./root');var shim=USE('./shim');var S=USE('./settings');SEA.name=SEA.name||(async(cb,opt)=>{try{if(cb){try{cb()}catch(e){console.log(e)}}
return}catch(e){console.log(e);SEA.err=e;if(SEA.throw){throw e}
if(cb){cb()}
return}});SEA.pair=SEA.pair||(async(cb,opt)=>{try{var ecdhSubtle=shim.ossl||shim.subtle;var sa=await shim.subtle.generateKey({name:'ECDSA',namedCurve:'P-256'},!0,['sign','verify']).then(async(keys)=>{var key={};key.priv=(await shim.subtle.exportKey('jwk',keys.privateKey)).d;var pub=await shim.subtle.exportKey('jwk',keys.publicKey);key.pub=pub.x+'.'+pub.y;return key})
try{var dh=await ecdhSubtle.generateKey({name:'ECDH',namedCurve:'P-256'},!0,['deriveKey']).then(async(keys)=>{var key={};key.epriv=(await ecdhSubtle.exportKey('jwk',keys.privateKey)).d;var pub=await ecdhSubtle.exportKey('jwk',keys.publicKey);key.epub=pub.x+'.'+pub.y;return key})}catch(e){if(SEA.window){throw e}
if(e=='Error: ECDH is not a supported algorithm'){console.log('Ignoring ECDH...')}
else{throw e}}dh=dh||{};var r={pub:sa.pub,priv:sa.priv,epub:dh.epub,epriv:dh.epriv}
if(cb){try{cb(r)}catch(e){console.log(e)}}
return r}catch(e){console.log(e);SEA.err=e;if(SEA.throw){throw e}
if(cb){cb()}
return}});module.exports=SEA.pair})(USE,'./pair');USE(function(module){var SEA=USE('./root');var shim=USE('./shim');var S=USE('./settings');var sha=USE('./sha256');var u;SEA.sign=SEA.sign||(async(data,pair,cb,opt)=>{try{opt=opt||{};if(!(pair||opt).priv){pair=await SEA.I(null,{what:data,how:'sign',why:opt.why})}
if(u===data){throw '`undefined` not allowed.'}
var json=S.parse(data);var check=opt.check=opt.check||json;if(SEA.verify&&(SEA.opt.check(check)||(check&&check.s&&check.m))&&u!==await SEA.verify(check,pair)){var r=S.parse(check);if(!opt.raw){r='SEA'+JSON.stringify(r)}
if(cb){try{cb(r)}catch(e){console.log(e)}}
return r}
var pub=pair.pub;var priv=pair.priv;var jwk=S.jwk(pub,priv);var hash=await sha(json);var sig=await(shim.ossl||shim.subtle).importKey('jwk',jwk,{name:'ECDSA',namedCurve:'P-256'},!1,['sign']).then((key)=>(shim.ossl||shim.subtle).sign({name:'ECDSA',hash:{name:'SHA-256'}},key,new Uint8Array(hash)))
var r={m:json,s:shim.Buffer.from(sig,'binary').toString(opt.encode||'base64')}
if(!opt.raw){r='SEA'+JSON.stringify(r)}
if(cb){try{cb(r)}catch(e){console.log(e)}}
return r}catch(e){console.log(e);SEA.err=e;if(SEA.throw){throw e}
if(cb){cb()}
return}});module.exports=SEA.sign})(USE,'./sign');USE(function(module){var SEA=USE('./root');var shim=USE('./shim');var S=USE('./settings');var sha=USE('./sha256');var u;SEA.verify=SEA.verify||(async(data,pair,cb,opt)=>{try{var json=S.parse(data);if(!1===pair){var raw=S.parse(json.m);if(cb){try{cb(raw)}catch(e){console.log(e)}}
return raw}
opt=opt||{};var pub=pair.pub||pair;var key=SEA.opt.slow_leak?await SEA.opt.slow_leak(pub):await(shim.ossl||shim.subtle).importKey('jwk',S.jwk(pub),{name:'ECDSA',namedCurve:'P-256'},!1,['verify']);var hash=await sha(json.m);var buf,sig,check,tmp;try{buf=shim.Buffer.from(json.s,opt.encode||'base64');sig=new Uint8Array(buf);check=await(shim.ossl||shim.subtle).verify({name:'ECDSA',hash:{name:'SHA-256'}},key,sig,new Uint8Array(hash));if(!check){throw "Signature did not match."}}catch(e){if(SEA.opt.fallback){return await SEA.opt.fall_verify(data,pair,cb,opt)}}
var r=check?S.parse(json.m):u;if(cb){try{cb(r)}catch(e){console.log(e)}}
return r}catch(e){console.log(e);SEA.err=e;if(SEA.throw){throw e}
if(cb){cb()}
return}});module.exports=SEA.verify;var knownKeys={};var keyForPair=SEA.opt.slow_leak=pair=>{if(knownKeys[pair])return knownKeys[pair];var jwk=S.jwk(pair);knownKeys[pair]=(shim.ossl||shim.subtle).importKey("jwk",jwk,{name:'ECDSA',namedCurve:'P-256'},!1,["verify"]);return knownKeys[pair]};var O=SEA.opt;SEA.opt.fall_verify=async function(data,pair,cb,opt,f){if(f===SEA.opt.fallback){throw "Signature did not match"}f=f||1;var tmp=data||'';data=SEA.opt.unpack(data)||data;var json=S.parse(data),pub=pair.pub||pair,key=await SEA.opt.slow_leak(pub);var hash=(f<=SEA.opt.fallback)?shim.Buffer.from(await shim.subtle.digest({name:'SHA-256'},new shim.TextEncoder().encode(S.parse(json.m)))):await sha(json.m);var buf;var sig;var check;try{buf=shim.Buffer.from(json.s,opt.encode||'base64')
sig=new Uint8Array(buf)
check=await(shim.ossl||shim.subtle).verify({name:'ECDSA',hash:{name:'SHA-256'}},key,sig,new Uint8Array(hash))
if(!check){throw "Signature did not match."}}catch(e){buf=shim.Buffer.from(json.s,'utf8')
sig=new Uint8Array(buf)
check=await(shim.ossl||shim.subtle).verify({name:'ECDSA',hash:{name:'SHA-256'}},key,sig,new Uint8Array(hash))
if(!check){throw "Signature did not match."}}
var r=check?S.parse(json.m):u;O.fall_soul=tmp['#'];O.fall_key=tmp['.'];O.fall_val=data;O.fall_state=tmp['>'];if(cb){try{cb(r)}catch(e){console.log(e)}}
return r}
SEA.opt.fallback=2})(USE,'./verify');USE(function(module){var shim=USE('./shim');var S=USE('./settings');var sha256hash=USE('./sha256');const importGen=async(key,salt,opt)=>{var opt=opt||{};const combo=key+(salt||shim.random(8)).toString('utf8');const hash=shim.Buffer.from(await sha256hash(combo),'binary')
const jwkKey=S.keyToJwk(hash)
return await shim.subtle.importKey('jwk',jwkKey,{name:'AES-GCM'},!1,['encrypt','decrypt'])}
module.exports=importGen})(USE,'./aeskey');USE(function(module){var SEA=USE('./root');var shim=USE('./shim');var S=USE('./settings');var aeskey=USE('./aeskey');var u;SEA.encrypt=SEA.encrypt||(async(data,pair,cb,opt)=>{try{opt=opt||{};var key=(pair||opt).epriv||pair;if(u===data){throw '`undefined` not allowed.'}
if(!key){pair=await SEA.I(null,{what:data,how:'encrypt',why:opt.why});key=pair.epriv||pair}
var msg=(typeof data=='string')?data:JSON.stringify(data);var rand={s:shim.random(9),iv:shim.random(15)};var ct=await aeskey(key,rand.s,opt).then((aes)=>(shim.subtle).encrypt({name:opt.name||'AES-GCM',iv:new Uint8Array(rand.iv)},aes,new shim.TextEncoder().encode(msg)));var r={ct:shim.Buffer.from(ct,'binary').toString(opt.encode||'base64'),iv:rand.iv.toString(opt.encode||'base64'),s:rand.s.toString(opt.encode||'base64')}
if(!opt.raw){r='SEA'+JSON.stringify(r)}
if(cb){try{cb(r)}catch(e){console.log(e)}}
return r}catch(e){console.log(e);SEA.err=e;if(SEA.throw){throw e}
if(cb){cb()}
return}});module.exports=SEA.encrypt})(USE,'./encrypt');USE(function(module){var SEA=USE('./root');var shim=USE('./shim');var S=USE('./settings');var aeskey=USE('./aeskey');SEA.decrypt=SEA.decrypt||(async(data,pair,cb,opt)=>{try{opt=opt||{};var key=(pair||opt).epriv||pair;if(!key){pair=await SEA.I(null,{what:data,how:'decrypt',why:opt.why});key=pair.epriv||pair}
var json=S.parse(data);var buf,bufiv,bufct;try{buf=shim.Buffer.from(json.s,opt.encode||'base64');bufiv=shim.Buffer.from(json.iv,opt.encode||'base64');bufct=shim.Buffer.from(json.ct,opt.encode||'base64');var ct=await aeskey(key,buf,opt).then((aes)=>(shim.subtle).decrypt({name:opt.name||'AES-GCM',iv:new Uint8Array(bufiv),tagLength:128},aes,new Uint8Array(bufct)))}catch(e){if('utf8'===opt.encode){throw "Could not decrypt"}
if(SEA.opt.fallback){opt.encode='utf8';return await SEA.decrypt(data,pair,cb,opt)}}
var r=S.parse(new shim.TextDecoder('utf8').decode(ct));if(cb){try{cb(r)}catch(e){console.log(e)}}
return r}catch(e){console.log(e);SEA.err=e;if(SEA.throw){throw e}
if(cb){cb()}
return}});module.exports=SEA.decrypt})(USE,'./decrypt');USE(function(module){var SEA=USE('./root');var shim=USE('./shim');var S=USE('./settings');SEA.secret=SEA.secret||(async(key,pair,cb,opt)=>{try{opt=opt||{};if(!pair||!pair.epriv||!pair.epub){pair=await SEA.I(null,{what:key,how:'secret',why:opt.why})}
var pub=key.epub||key;var epub=pair.epub;var epriv=pair.epriv;var ecdhSubtle=shim.ossl||shim.subtle;var pubKeyData=keysToEcdhJwk(pub);var props=Object.assign({public:await ecdhSubtle.importKey(...pubKeyData,!0,[])},{name:'ECDH',namedCurve:'P-256'});var privKeyData=keysToEcdhJwk(epub,epriv);var derived=await ecdhSubtle.importKey(...privKeyData,!1,['deriveBits']).then(async(privKey)=>{var derivedBits=await ecdhSubtle.deriveBits(props,privKey,256);var rawBits=new Uint8Array(derivedBits);var derivedKey=await ecdhSubtle.importKey('raw',rawBits,{name:'AES-GCM',length:256},!0,['encrypt','decrypt']);return ecdhSubtle.exportKey('jwk',derivedKey).then(({k})=>k)})
var r=derived;if(cb){try{cb(r)}catch(e){console.log(e)}}
return r}catch(e){console.log(e);SEA.err=e;if(SEA.throw){throw e}
if(cb){cb()}
return}});var keysToEcdhJwk=(pub,d)=>{var[x,y]=pub.split('.')
var jwk=d?{d:d}:{}
return['jwk',Object.assign(jwk,{x:x,y:y,kty:'EC',crv:'P-256',ext:!0}),{name:'ECDH',namedCurve:'P-256'}]}
module.exports=SEA.secret})(USE,'./secret');USE(function(module){var shim=USE('./shim');var SEA=USE('./root');SEA.work=USE('./work');SEA.sign=USE('./sign');SEA.verify=USE('./verify');SEA.encrypt=USE('./encrypt');SEA.decrypt=USE('./decrypt');SEA.opt.aeskey=USE('./aeskey');SEA.random=SEA.random||shim.random;SEA.Buffer=SEA.Buffer||USE('./buffer');SEA.keyid=SEA.keyid||(async(pub)=>{try{const pb=Buffer.concat(pub.replace(/-/g,'+').replace(/_/g,'/').split('.').map((t)=>Buffer.from(t,'base64')))
const id=Buffer.concat([Buffer.from([0x99,pb.length/0x100,pb.length%0x100]),pb])
const sha1=await sha1hash(id)
const hash=Buffer.from(sha1,'binary')
return hash.toString('hex',hash.length-8)}catch(e){console.log(e)
throw e}});var Gun=(SEA.window||{}).Gun||USE((typeof MODULE=="undefined"?'.':'')+'./gun',1);Gun.SEA=SEA;SEA.GUN=SEA.Gun=Gun;module.exports=SEA})(USE,'./sea');USE(function(module){var Gun=USE('./sea').Gun;Gun.chain.then=function(cb){var gun=this,p=(new Promise(function(res,rej){gun.once(res)}));return cb?p.then(cb):p}})(USE,'./then');USE(function(module){var SEA=USE('./sea');var Gun=SEA.Gun;var then=USE('./then');function User(root){this._={$:this}}
User.prototype=(function(){function F(){};F.prototype=Gun.chain;return new F()}())
User.prototype.constructor=User;Gun.chain.user=function(pub){var gun=this,root=gun.back(-1),user;if(pub){return root.get('~'+pub)}
if(user=root.back('user')){return user}
var root=(root._),at=root,uuid=at.opt.uuid||Gun.state.lex;(at=(user=at.user=gun.chain(new User))._).opt={};at.opt.uuid=function(cb){var id=uuid(),pub=root.user;if(!pub||!(pub=pub.is)||!(pub=pub.pub)){return id}
id=id+'~'+pub+'.';if(cb&&cb.call){cb(null,id)}
return id}
return user}
Gun.User=User;module.exports=User})(USE,'./user');USE(function(module){var SEA=USE('./sea');var User=USE('./user');var authsettings=USE('./settings');var Gun=SEA.Gun;var noop=function(){};User.prototype.create=function(alias,pass,cb,opt){var gun=this,cat=(gun._),root=gun.back(-1);cb=cb||noop;if(cat.ing){cb({err:Gun.log("User is already being created or authenticated!"),wait:!0});return gun}
cat.ing=!0;opt=opt||{};var act={},u;act.a=function(pubs){act.pubs=pubs;if(pubs&&!opt.already){var ack={err:Gun.log('User already created!')};cat.ing=!1;cb(ack);gun.leave();return}
act.salt=Gun.text.random(64);SEA.work(pass,act.salt,act.b)}
act.b=function(proof){act.proof=proof;SEA.pair(act.c)}
act.c=function(pair){var tmp;act.pair=pair||{};if(tmp=cat.root.user){tmp._.sea=pair;tmp.is={pub:pair.pub,epub:pair.epub,alias:alias}}
act.data={pub:pair.pub};act.d()}
act.d=function(){act.data.alias=alias;act.e()}
act.e=function(){act.data.epub=act.pair.epub;SEA.encrypt({priv:act.pair.priv,epriv:act.pair.epriv},act.proof,act.f,{raw:1})}
act.f=function(auth){act.data.auth=JSON.stringify({ek:auth,s:act.salt});act.g(act.data.auth)}
act.g=function(auth){var tmp;act.data.auth=act.data.auth||auth;root.get(tmp='~'+act.pair.pub).put(act.data);root.get('~@'+alias).put(Gun.obj.put({},tmp,Gun.val.link.ify(tmp)));setTimeout(function(){cat.ing=!1;cb({ok:0,pub:act.pair.pub});if(noop===cb){gun.auth(alias,pass)}},10)}
root.get('~@'+alias).once(act.a);return gun}
User.prototype.auth=function(alias,pass,cb,opt){var gun=this,cat=(gun._),root=gun.back(-1);cb=cb||function(){};if(cat.ing){cb({err:Gun.log("User is already being created or authenticated!"),wait:!0});return gun}
cat.ing=!0;opt=opt||{};var pair=(alias&&(alias.pub||alias.epub))?alias:(pass&&(pass.pub||pass.epub))?pass:null;var act={},u;act.a=function(data){if(!data){return act.b()}
if(!data.pub){var tmp=[];Gun.node.is(data,function(v){tmp.push(v)})
return act.b(tmp)}
if(act.name){return act.f(data)}
act.c((act.data=data).auth)}
act.b=function(list){var get=(act.list=(act.list||[]).concat(list||[])).shift();if(u===get){if(act.name){return act.err('Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.')}
return act.err('Wrong user or password.')}
root.get(get).once(act.a)}
act.c=function(auth){if(u===auth){return act.b()}
if(Gun.text.is(auth)){return act.c(Gun.obj.ify(auth))}
SEA.work(pass,(act.auth=auth).s,act.d,act.enc)}
act.d=function(proof){SEA.decrypt(act.auth.ek,proof,act.e,act.enc)}
act.e=function(half){if(u===half){if(!act.enc){act.enc={encode:'utf8'};return act.c(act.auth)}act.enc=null;return act.b()}
act.half=half;act.f(act.data)}
act.f=function(data){if(!data||!data.pub){return act.b()}
var tmp=act.half||{};act.g({pub:data.pub,epub:data.epub,priv:tmp.priv,epriv:tmp.epriv})}
act.g=function(pair){act.pair=pair;var user=(root._).user,at=(user._);var tmp=at.tag;var upt=at.opt;at=user._=root.get('~'+pair.pub)._;at.opt=upt;user.is={pub:pair.pub,epub:pair.epub,alias:alias};at.sea=act.pair;cat.ing=!1;try{if(pass&&!Gun.obj.has(Gun.obj.ify(cat.root.graph['~'+pair.pub].auth),':')){opt.shuffle=opt.change=pass}}catch(e){}
opt.change?act.z():cb(at);if(SEA.window&&((gun.back('user')._).opt||opt).remember){try{var sS={};sS=window.sessionStorage;sS.recall=!0;sS.alias=alias;sS.tmp=pass}catch(e){}}
try{(root._).on('auth',at)}catch(e){Gun.log("Your 'auth' callback crashed with:",e)}}
act.z=function(){act.salt=Gun.text.random(64);SEA.work(opt.change,act.salt,act.y)}
act.y=function(proof){SEA.encrypt({priv:act.pair.priv,epriv:act.pair.epriv},proof,act.x,{raw:1})}
act.x=function(auth){act.w(JSON.stringify({ek:auth,s:act.salt}))}
act.w=function(auth){if(opt.shuffle){console.log('migrate core account from UTF8 & shuffle');var tmp=Gun.obj.to(act.data);Gun.obj.del(tmp,'_');tmp.auth=auth;root.get('~'+act.pair.pub).put(tmp)}
root.get('~'+act.pair.pub).get('auth').put(auth,cb)}
act.err=function(e){var ack={err:Gun.log(e||'User cannot be found!')};cat.ing=!1;cb(ack)}
act.plugin=function(name){if(!(act.name=name)){return act.err()}
var tmp=[name];if('~'!==name[0]){tmp[1]='~'+name;tmp[2]='~@'+name}
act.b(tmp)}
if(pair){act.g(pair)}else if(alias){root.get('~@'+alias).once(act.a)}else if(!alias&&!pass){SEA.name(act.plugin)}
return gun}
User.prototype.pair=function(){console.log("user.pair() IS DEPRECATED AND WILL BE DELETED!!!");var user=this;if(!user.is){return!1}
return user._.sea}
User.prototype.leave=function(opt,cb){var gun=this,user=(gun.back(-1)._).user;if(user){delete user.is;delete user._.is;delete user._.sea}
if(SEA.window){try{var sS={};sS=window.sessionStorage;delete sS.alias;delete sS.tmp;delete sS.recall}catch(e){}}
return gun}
User.prototype.delete=async function(alias,pass,cb){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var gun=this,root=gun.back(-1),user=gun.back('user');try{user.auth(alias,pass,function(ack){var pub=(user.is||{}).pub;user.map().once(function(){this.put(null)});user.leave();(cb||noop)({ok:0})})}catch(e){Gun.log('User.delete failed! Error:',e)}
return gun}
User.prototype.recall=function(opt,cb){var gun=this,root=gun.back(-1),tmp;opt=opt||{};if(opt&&opt.sessionStorage){if(SEA.window){try{var sS={};sS=window.sessionStorage;if(sS){(root._).opt.remember=!0;((gun.back('user')._).opt||opt).remember=!0;if(sS.recall||(sS.alias&&sS.tmp)){root.user().auth(sS.alias,sS.tmp,cb)}}}catch(e){}}
return gun}
return gun}
User.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const gunRoot=this.back(-1)
try{await authRecall(gunRoot)
return gunRoot._.user._}catch(e){const err='No session!'
Gun.log(err)
throw{err}}}
User.prototype.trust=async function(user){if(Gun.is(user)){user.get('pub').get((ctx,ev)=>{console.log(ctx,ev)})}
user.get('trust').get(path).put(theirPubkey)}
User.prototype.grant=function(to,cb){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var gun=this,user=gun.back(-1).user(),pair=user._.sea,path='';gun.back(function(at){if(at.is){return}path+=(at.get||'')});(async function(){var enc,sec=await user.get('grant').get(pair.pub).get(path).then();sec=await SEA.decrypt(sec,pair);if(!sec){sec=SEA.random(16).toString();enc=await SEA.encrypt(sec,pair);user.get('grant').get(pair.pub).get(path).put(enc)}
var pub=to.get('pub').then();var epub=to.get('epub').then();pub=await pub;epub=await epub;var dh=await SEA.secret(epub,pair);enc=await SEA.encrypt(sec,dh);user.get('grant').get(pub).get(path).put(enc,cb)}());return gun}
User.prototype.secret=function(data,cb){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var gun=this,user=gun.back(-1).user(),pair=user.pair(),path='';gun.back(function(at){if(at.is){return}path+=(at.get||'')});(async function(){var enc,sec=await user.get('trust').get(pair.pub).get(path).then();sec=await SEA.decrypt(sec,pair);if(!sec){sec=SEA.random(16).toString();enc=await SEA.encrypt(sec,pair);user.get('trust').get(pair.pub).get(path).put(enc)}
enc=await SEA.encrypt(data,sec);gun.put(enc,cb)}());return gun}
module.exports=User})(USE,'./create');USE(function(module){var SEA=USE('./sea')
var Gun=SEA.Gun;Gun.on('opt',function(at){if(!at.sea){at.sea={own:{}};at.on('put',check,at)}
this.to.next(at)});function each(msg){var to=this.to,vertex=(msg.$._).put,c=0,d;Gun.node.is(msg.put,function(val,key,node){var tmp=Gun.obj.ify(val)||noop;if(u!==tmp[':']){node[key]=SEA.opt.unpack(tmp);return}
if(!SEA.opt.check(val)){return}
c++;SEA.verify(val,!1,function(data){c--;node[key]=SEA.opt.unpack(data,key,node);if(d&&!c&&(c=-1)){to.next(msg)}})});if((d=!0)&&!c){to.next(msg)}}
function signature(msg){if((msg._||noop).user){return this.to.next(msg)}
var ctx=this.as;(msg._||(msg._=function(){})).user=ctx.user;security.call(this,msg)}
var u;function check(msg){var eve=this,at=eve.as,put=msg.put,soul=put['#'],key=put['.'],val=put[':'],state=put['>'],id=msg['#'],tmp;if((msg._||'').faith&&(at.opt||'').faith&&'function'==typeof msg._){SEA.verify(SEA.opt.pack(put),!1,function(data){put['=']=SEA.opt.unpack(data);eve.to.next(msg)});return}
var no=function(why){at.on('in',{'@':id,err:why})};(msg._||'').DBG&&((msg._||'').DBG.c=+new Date);if('#'===soul[0]){check.hash(eve,msg,val,key,soul,at,no);return}
if('~@'===soul){check.alias(eve,msg,val,key,soul,at,no);return}
if('~@'===soul.slice(0,2)){check.pubs(eve,msg,val,key,soul,at,no);return}
if(tmp=SEA.opt.pub(soul)){check.pub(eve,msg,val,key,soul,at,no,at.user||'',tmp);return}
check.any(eve,msg,val,key,soul,at,no,at.user||'');return;eve.to.next(msg)}
check.hash=function(eve,msg,val,key,soul,at,no){SEA.work(val,null,function(data){if(data&&data===key.split('#').slice(-1)[0]){return eve.to.next(msg)}
no("Data hash not same as hash!")},{name:'SHA-256'})}
check.alias=function(eve,msg,val,key,soul,at,no){if(!val){return no("Data must exist!")}
if('~@'+key===link_is(val)){return eve.to.next(msg)}
no("Alias not same!")};check.pubs=function(eve,msg,val,key,soul,at,no){if(!val){return no("Alias must exist!")}
if(key===link_is(val)){return eve.to.next(msg)}
no("Alias not same!")};check.pub=function(eve,msg,val,key,soul,at,no,user,pub){var tmp;if('pub'===key&&'~'+pub===soul){if(val===pub){return eve.to.next(msg)}
return no("Account not same!")}
if((tmp=user.is)&&pub===tmp.pub){SEA.sign(SEA.opt.pack(msg.put),(user._).sea,function(data){if(u===data){return no(SEA.err||'Signature fail.')}
if(tmp=link_is(val)){(at.sea.own[tmp]=at.sea.own[tmp]||{})[pub]=1}
msg.put[':']=JSON.stringify({':':tmp=SEA.opt.unpack(data.m),'~':data.s});msg.put['=']=tmp;eve.to.next(msg)},{raw:1});return}
SEA.verify(SEA.opt.pack(msg.put),pub,function(data){var tmp;data=SEA.opt.unpack(data);if(u===data){return no("Unverified data.")}
if((tmp=link_is(data))&&pub===SEA.opt.pub(tmp)){(at.sea.own[tmp]=at.sea.own[tmp]||{})[pub]=1}
msg.put['=']=data;eve.to.next(msg)})};check.any=function(eve,msg,val,key,soul,at,no,user){var tmp,pub;if(at.opt.secure){return no("Soul missing public key at '"+key+"'.")}
at.on('secure',function(msg){this.off();if(!at.opt.secure){return eve.to.next(msg)}
no("Data cannot be changed.")}).on.on('secure',msg);return}
var link_is=Gun.val.link.is,state_ify=Gun.state.ify;function security(msg){var at=this.as,sea=at.sea,to=this.to;if(at.opt.faith&&(msg._||noop).faith){this.to.next(msg);return}
if(msg.get){var soul=msg.get['#'];if(soul){if(typeof soul!=='string'){return to.next(msg)}
if('alias'===soul){return to.next(msg)}else if('~@'===soul.slice(0,2)){return to.next(msg)}else{return to.next(msg)}}}
if(msg.put){var check={},each={},u;each.node=function(node,soul){if(Gun.obj.empty(node,'_')){return check['node'+soul]=0}
Gun.obj.map(node,each.way,{soul:soul,node:node})};each.way=function(val,key){var soul=this.soul,node=this.node,tmp;if('_'===key){return}
if('~@'===soul){each.alias(val,key,node,soul);return}
if('~@'===soul.slice(0,2)){each.pubs(val,key,node,soul);return}
if('~'===soul.slice(0,1)&&2===(tmp=soul.slice(1)).split('.').length){each.pub(val,key,node,soul,tmp,(msg._||noop).user);return}
each.any(val,key,node,soul,(msg._||noop).user);return;return each.end({err:"No other data allowed!"})};each.alias=function(val,key,node,soul){if(!val){return each.end({err:"Data must exist!"})}
if('~@'+key===Gun.val.link.is(val)){return check['alias'+key]=0}
each.end({err:"Mismatching alias."})};each.pubs=function(val,key,node,soul){if(!val){return each.end({err:"Alias must exist!"})}
if(key===Gun.val.link.is(val)){return check['pubs'+soul+key]=0}
each.end({err:"Alias must match!"})};each.pub=function(val,key,node,soul,pub,user){var tmp;if('pub'===key){if(val===pub){return(check['pub'+soul+key]=0)}
return each.end({err:"Account must match!"})}
check['user'+soul+key]=1;if(Gun.is(msg.$)&&user&&user.is&&pub===user.is.pub){SEA.sign(SEA.opt.prep(tmp=SEA.opt.parse(val),key,node,soul),(user._).sea,function(data){var rel;if(u===data){return each.end({err:SEA.err||'Pub signature fail.'})}
if(rel=Gun.val.link.is(val)){(at.sea.own[rel]=at.sea.own[rel]||{})[pub]=!0}
node[key]=JSON.stringify({':':SEA.opt.unpack(data.m),'~':data.s});check['user'+soul+key]=0;each.end({ok:1})},{check:SEA.opt.pack(tmp,key,node,soul),raw:1});return}
SEA.verify(SEA.opt.pack(val,key,node,soul),pub,function(data){var rel,tmp;data=SEA.opt.unpack(data,key,node);if(u===data){return each.end({err:"Unverified data."})}
if((rel=Gun.val.link.is(data))&&pub===SEA.opt.pub(rel)){(at.sea.own[rel]=at.sea.own[rel]||{})[pub]=!0}
check['user'+soul+key]=0;each.end({ok:1})})};each.any=function(val,key,node,soul,user){var tmp,pub;if(!(pub=SEA.opt.pub(soul))){if(at.opt.secure){each.end({err:"Soul is missing public key at '"+key+"'."});return}
check['any'+soul+key]=1;at.on('secure',function(msg){this.off();check['any'+soul+key]=0;if(at.opt.secure){msg=null}
each.end(msg||{err:"Data cannot be modified."})}).on.on('secure',msg);return}
if(Gun.is(msg.$)&&user&&user.is&&pub===user.is.pub){check['any'+soul+key]=1;SEA.sign(SEA.opt.prep(tmp=SEA.opt.parse(val),key,node,soul),(user._).sea,function(data){if(u===data){return each.end({err:'My signature fail.'})}
node[key]=JSON.stringify({':':SEA.opt.unpack(data.m),'~':data.s});check['any'+soul+key]=0;each.end({ok:1})},{check:SEA.opt.pack(tmp,key,node,soul),raw:1});return}
check['any'+soul+key]=1;SEA.verify(SEA.opt.pack(val,key,node,soul),pub,function(data){var rel;data=SEA.opt.unpack(data,key,node);if(u===data){return each.end({err:"Mismatched owner on '"+key+"'."})}
if((rel=Gun.val.link.is(data))&&pub===SEA.opt.pub(rel)){(at.sea.own[rel]=at.sea.own[rel]||{})[pub]=!0}
check['any'+soul+key]=0;each.end({ok:1})})}
each.end=function(ctx){if(each.err){return}
if((each.err=ctx.err)||ctx.no){console.log('NO!',each.err,msg.put);return}
if(!each.end.ed){return}
if(Gun.obj.map(check,function(no){if(no){return!0}})){return}(msg._||{}).user=at.user||security;to.next(msg)};Gun.obj.map(msg.put,each.node);each.end({end:each.end.ed=!0});return}
to.next(msg)}
SEA.opt.pub=function(s){if(!s){return}
s=s.split('~');if(!s||!(s=s[1])){return}
s=s.split('.');if(!s||2>s.length){return}
if('@'===(s[0]||'')[0]){return}
s=s.slice(0,2).join('.');return s}
SEA.opt.prep=function(d,k,n,s){return{'#':s,'.':k,':':SEA.opt.parse(d),'>':Gun.state.is(n,k)}}
SEA.opt.pack=function(d,k,n,s){if(SEA.opt.check(d)){return d}
var meta=(Gun.obj.ify((d&&d[':'])||d)||''),sig=meta['~'];return sig?{m:{'#':s||d['#'],'.':k||d['.'],':':meta[':'],'>':d['>']||Gun.state.is(n,k)},s:sig}:d}
var O=SEA.opt;SEA.opt.unpack=function(d,k,n){var tmp;if(u===d){return}
if(d&&(u!==(tmp=d[':']))){return tmp}
k=k||O.fall_key;if(!n&&O.fall_val){n={};n[k]=O.fall_val}
if(!k||!n){return}
if(d===n[k]){return d}
if(!SEA.opt.check(n[k])){return d}
var soul=Gun.node.soul(n)||O.fall_soul,s=Gun.state.is(n,k)||O.fall_state;if(d&&4===d.length&&soul===d[0]&&k===d[1]&&fl(s)===fl(d[3])){return d[2]}
if(s<SEA.opt.shuffle_attack){return d}}
SEA.opt.shuffle_attack=1546329600000;var noop=function(){},u;var fl=Math.floor;var rel_is=Gun.val.rel.is;var obj_ify=Gun.obj.ify})(USE,'./index')}())
